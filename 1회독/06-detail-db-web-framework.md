# 세부사항 - 데이터베이스, 웹, 프레임워크

> Clean Architecture 6부 30~32장

## 데이터베이스는 세부사항이다

- 애플리케이션 내부 데이터 구조는 아키텍처에서 대단히 중요하다.
- 하지만, **데이터베이스는 데이터 모델이 아니다**. 데이터베이스는 데이터를 관리하고 데이터에 접근할 방법을 제공하는 유틸리티이다.
- 즉, 데이터베이스(유틸리티)는 **저수준의 세부사항**이므로 아키텍처와 관련이 없다.

### 관계형 데이터베이스

- 관계형 데이터베이스는 데이터를 특정한 방식으로 저장하고 접근할 수 있도록 설계한 것이다. (e.g. 관계형 테이블에 행(row) 구조로 데이터 저장)
- 즉, 관계형 데이터베이스는 기술일 뿐이므로 아키텍처에서 세부사항에 해당한다.
- Application의 Use Case는 **데이터를 테이블에 행 단위로 배치한다는 사실**을 알아서는 안되고, 알 필요도 없다.
    - _`~Record`와 같은 이름으로 행 자체를 묘사하는 듯한 객체를 사용하면 안될 것이다._
- 이런 세부사항들은 아키텍처의 외부 원에 위치한 최하위 수준 유틸리티 함수만 알아야 한다.
- 데이터베이스를 사용하든 예전 방식인 디스크를 사용하든, 디스크에 저장된 데이터를 RAM으로 옮겨서 사용하는 것은 동일하다.
- 즉, 데이터베이스도 디스크에 저장된 데이터를 RAM으로 가져올 때 사용하는 기술일 뿐이다.
- 따라서, 아키텍처 관점에서 데이터가 존재한다는 것은 알아도 그 데이터가 **어떤 형태이며 어떻게 가져오는지**에 대해서는 절대로 신경 쓰면 안된다.
    - 관계형 데이터베이스는 데이터를 테이블과 행 구조로 저장하며 SQL을 통해서만 데이터에 접근하고 가져올 수 있다.
    - 아키텍처는 이러한 저수준 세부사항을 전혀 몰라야 한다.

### 성능 문제

- 데이터베이스를 사용하는게 성능면에 이점이 있을 수 있다.
- 하지만, 아키텍처는 성능에 대해 신경쓰지 않는다.
- 성능은 아키텍처 바깥의 저수준의 데이터 접근 매커니즘 단에서 다뤄져야 한다.

## 웹은 세부사항이다

- 1960년대 이후로, 연산 능력을 중앙 서버에 두는 방식과 단말에 두는 방식 사이에서 진동을 겪어 왔다.
- 웹은 이런 진동의 맨 끝에 있을 뿐, 아무것도 바뀌지 않았다.
- 웹이 인기를 끌면서, "마케팅 천재"에 의해 UI와 룩앤필을 완전히 바꿔버리는 시도들이 있었다.
- 이런 "마케팅 천재"들은 어디에나 존재하므로, 이들로부터 애플리케이션을 보호하기 위해 **업무 규칙을 추상화하여 업무 규칙과 UI를 분리해야 한다.**
- 즉, GUI는 세부사항이며 웹은 GUI이므로 **웹은 세부사항이다.**
- 따라서, 웹을 핵심 업무 로직에서 분리된 **경계 바깥**에 두어야 한다.
- UI와 애플리케이션 사이에 '**유스케이스**'를 두고, 유스케이스가 사용자를 대신해서 일부 함수를 실행(수행)하도록 봐야 한다.
- 각 유스케이스는 입력 데이터, 수행할 처리 과정, 출력 데이터를 기반으로 작성할 수 있다.
- 완전한 입력 데이터와 그에 따른 출력 데이터는 데이터 구조로 만들어서 유스케이스를 실행하는 처리 과정의 입력 값과 출력 값으로 사용할 수 있다.
    - UseCase의 Input Port와 Output Port

## 프레임워크는 세부사항이다

- 프레임워크는 강력하지만, 아키텍처가 될 수 없다.
- 프레임워크를 만든 제작자는 우리의 문제를 해결하기 위해 프레임워크를 만든게 아니므로, 우리가 풀어야 하는 문제에 특별한 관심사를 두지 않는다.
- 우리는 프레임워크를 위해 대단히 큰 헌신을 해야 하지만, 프레임워크 제작자는 우리를 위해 아무런 헌신도 하지 않는다.
- 프레임워크 제작자는 문서에서 프레임워크를 중심에 두고 아키텍처가 그 바깥을 감싸야 한다고 말한다.
- 프레임워크의 기반 클래스에서 직접 파생하거나(상속), 프레임워크 기능들을 업무 객체이 직접 import 해서 사용하는 것을 권한다.

### 위험 요인

1. 프레임워크의 아키텍처가 깔끔하지 않은 경우가 많다.
    - 프레임워크는 의존성 규칙을 위반하는 경향이 있다.
2. 프레임워크는 애플리케이션 초기 기능을 만들 때는 도움이 되지만, 점점 벗어나게 될 것이다.
3. 프레임워크는 우리에게 도움이 되지 않는 방향으로 진화할 수도 있다.
    - 전혀 도움이 되지 않거나 상관 없는 변경사항에 영향을 받을 수도 있다.
    - 사용 중이던 기능이 사라지거나 반영하기 힘든 형태로 변경될 수도 있다.
4. 더 나은 새로운 프레임워크로 갈아타고 싶을 수도 있다.

### 해결책

- 프레임워크와 결합하지 말고, **프록시(proxy)**를 만들어서 업무 규칙에 플러그인 할 수 있는 컴포넌트에서 사용한다.
- 프레임워크는 아키텍처 바깥쪽 원에 속하는 세부 사항으로 취급하라.
- 핵심 코드에 플러그인할 수 있는 컴포넌트에 프레임워크를 통합하고, 의존성 규칙을 준수하라. 프레임워크를 핵심 코드에 직접 import 하면 안된다.
- 의존성 주입은 메인 컴포넌트에서 하는 편이 더 낫다.
    - 메인 컴포넌트는 애플리케이션에서 가장 지저분산 최저 수준의 컴포넌트이므로 이 작업에 적당하다.
- 프레임워크를 사용하고자 한다면, 애플리케이션의 남은 생애 동안 그 프레임워크와 항상 함께 해야 한다는 사실을 명심해야 한다.
- 프레임워크는 가능한 한 오랫 동안 아키텍처 경계 너머에 두자.